"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = globalSetup;
const test_1 = require("@playwright/test");
const page_manager_1 = require("./src/page-manager");
const faker_1 = require("@faker-js/faker");
const generate_password_1 = require("generate-password");
const fs_1 = require("fs");
async function globalSetup() {
    console.log("start");
    const browser = await test_1.chromium.launch();
    const context = await browser.newContext();
    const page = await context.newPage();
    let email = faker_1.faker.internet.email();
    let firstName = faker_1.faker.internet.username();
    let lastName = faker_1.faker.internet.username();
    let phone = faker_1.faker.phone.number();
    let password = generate_password_1.default.generate({ length: 14, numbers: true, uppercase: true, lowercase: true, symbols: true, strict: true });
    const pageManager = page_manager_1.PageManager.getPageManagerInstance(page);
    const loginInstance = pageManager.getLoginInstance();
    const signIn = pageManager.getSignUp();
    await loginInstance.login();
    await signIn.inputEmailField(email);
    await signIn.nextButtonClick();
    await (0, test_1.expect)(page).toHaveURL("https://apply.mykaleidoscope.com/signup");
    await signIn.inputFirstName(firstName);
    await signIn.inputLastName(lastName);
    await signIn.inputMobilePhone(phone);
    await signIn.inputPassword(password);
    await signIn.minimumAgeCheckbox();
    (0, test_1.expect)(signIn.getCheckboxLocator()).toBeChecked();
    await signIn.submitButton();
    await page.waitForURL("**/application/start", { timeout: 10000 });
    await page.waitForLoadState('load');
    await (0, test_1.expect)(page).toHaveURL("https://apply.mykaleidoscope.com/program/a0DTP00000H3PUy2AN/application/start");
    fs_1.default.mkdirSync('./playwright/.auth', { recursive: true });
    await context.storageState({ path: './playwright/.auth/auth.json' });
    // await page.context().storageState({path:"./playwright/.auth/auth.json"});
    console.log("close");
    await browser.close();
}
